# Docker Usage

Last modified: 2023/12/18 16:38:39

- [Manage Docker as a non-root user (less secure)](#manage-docker-as-a-non-root-user-less-secure)
- [Rootless mode (more secure)](#rootless-mode-more-secure)
- [Access Docker container ports from host](#access-docker-container-ports-from-host)
- [Access host ports in Docker containers](#access-host-ports-in-docker-containers)
- [Configure automatically start behavior](#configure-automatically-start-behavior)
   - [Start containers automatically](#start-containers-automatically)
   - [Check automatically start status](#check-automatically-start-status)
   - [Change automatically start configs](#change-automatically-start-configs)
- [Stop all containers](#stop-all-containers)
- [VSCode \& Docker](#vscode--docker)
- [Run a local registry server (image server)](#run-a-local-registry-server-image-server)
- [WARP issue](#warp-issue)

For installation, see:

- openSUSE Tumbleweed: [[Tumbleweed/dev-env#Docker]]

## Manage Docker as a non-root user (less secure)

1. Add yourself to the `docker` group via the following commands:

   ```bash
   sudo usermod -aG docker $USER
   ```

2. Log out and Log back in to take effect.

*References*:

- [Manage Docker as a non-root user](https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user)

## Rootless mode (more secure)

- [ ] todo

*References*:

- [Run the Docker daemon as a non-root user (Rootless mode)](https://docs.docker.com/engine/security/rootless/)

## Access Docker container ports from host

{% raw %}

For modern Docker engine, check the container's IP via `docker inspect -f "{{ .NetworkSettings.IPAddress }}" CONTAINER_NAME`.

For older Docker engine, check the container's IP via `docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' CONTAINER_NAME`.

{% endraw %}

*References*:

- [How to SSH into a Running Docker Container and Run Commands](https://phoenixnap.com/kb/how-to-ssh-into-docker-container#ftoc-heading-5)

## Access host ports in Docker containers

Find the `docker0` interface IP of the host via `ip addr show docker0`.

*References*:

- [How do I access the host port in a Docker container?](https://bright-softwares.com/blog/en/docker/how-do-i-access-the-host-port-in-a-docker-container#step-2-get-the-containers-ip)

## Configure automatically start behavior

### Start containers automatically

Use `docker run --restart no/on-failure/always/unless-stopped CONTAINER_NAME_OR_ID`.

### Check automatically start status

Use `docker container ls -q | xargs docker container inspect --format '{{.Name}}: {{.HostConfig.RestartPolicy.Name}}'`.

### Change automatically start configs

Use `docker update --restart no/on-failure/always/unless-stopped CONTAINER_NAME_OR_ID`.

*References*:

- [Start containers automatically \| Docker Docs](https://docs.docker.com/config/containers/start-containers-automatically/)
- [configuration - which images dockerd starts automatically? - Server Fault](https://serverfault.com/questions/897463/which-images-dockerd-starts-automatically)

## Stop all containers

Use `docker stop $(docker ps -a -q)`.

*References*:

- [Stop and remove all docker containers](https://stackoverflow.com/questions/45357771/stop-and-remove-all-docker-containers)

## VSCode & Docker

*References*:

- [Docker in Visual Studio Code](https://code.visualstudio.com/docs/containers/overview)
- [Developing inside a Container](https://code.visualstudio.com/docs/devcontainers/containers)
- [Connect to remote Docker over SSH](https://code.visualstudio.com/docs/containers/ssh)

## Run a local registry server (image server)

Use `docker run -d -p 5000:5000 --restart=always --name registry registry:2
`.

*References*:

- [Deploy a registry server \| Docker Docs](https://docs.docker.com/registry/deploying/#run-a-local-registry) (deprecated)
- [Deploy a registry server \| CNCF Distribution](https://distribution.github.io/distribution/about/deploying/)

## WARP issue

At the time of writing (*warp-cli 2023.7.40*), WARP may cause network trouble when building images.

[//begin]: # "Autogenerated link references for markdown compatibility"
[Tumbleweed/dev-env#Docker]: ..%2FopenSUSE%2FTumbleweed%2Fdev-env.md "OpenSUSE Tumbleweed Development Environment"
[//end]: # "Autogenerated link references"
